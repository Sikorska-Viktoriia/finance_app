#:kivy 2.3.1
#:import dp kivy.metrics.dp
#:import Window kivy.core.window.Window
#:import Platform kivy.utils.platform

#:set is_mobile True if Platform in ['android', 'ios'] else False
#:set screen_width Window.width
#:set screen_height Window.height
#:set is_small_screen screen_width < 400
#:set is_tablet screen_width >= 600

#:set scale_factor 1.0 if is_tablet else (0.9 if is_small_screen else 1.0)
#:set text_scale 1.0 if is_tablet else (0.9 if is_small_screen else 1.0)
#:set padding_scale 1.0 if is_tablet else (0.8 if is_small_screen else 1.0)

#:set adaptive_dp lambda x: dp(x * scale_factor)
#:set adaptive_font lambda x: dp(x * text_scale)
#:set adaptive_padding lambda x: dp(x * padding_scale)


#: set PRIMARY_PINK (0.95, 0.3, 0.5, 1)    # –Ø—Å–∫—Ä–∞–≤–∏–π —Ä–æ–∂–µ–≤–∏–π
#: set LIGHT_PINK (1, 0.95, 0.95, 1)       # –°–≤—ñ—Ç–ª–æ-—Ä–æ–∂–µ–≤–∏–π  
#: set PRIMARY_BLUE (0.2, 0.7, 0.9, 1)     # –Ø—Å–∫—Ä–∞–≤–∏–π –±–ª–∞–∫–∏—Ç–Ω–∏–π
#: set LIGHT_BLUE (0.92, 0.98, 1.0, 1)     # –°–≤—ñ—Ç–ª–æ-–±–ª–∞–∫–∏—Ç–Ω–∏–π
#: set SUCCESS_GREEN (0.2, 0.8, 0.3, 1)
#: set ERROR_RED (0.9, 0.2, 0.2, 1) 
#: set CREATION_BUTTON (0.95, 0.3, 0.5, 1)  # –†–æ–∂–µ–≤–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏
#: set SELECTED_ITEM_COLOR (0.85, 0.95, 1.0, 1) # –í–∏–¥—ñ–ª–µ–Ω–Ω—è


<GradientBox@BoxLayout>:
    color1: 1, 1, 1, 1
    canvas.before:
        Color:
            rgba: self.color1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [adaptive_dp(30),]

<StyledButton@Button>:
    background_normal: ''
    background_color: 1, 1, 1, 1
    color: 1, 1, 1, 1
    font_size: adaptive_font(18)
    size_hint_y: None
    height: adaptive_dp(60)
    canvas.before:
        Color:
            rgba: self.background_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [adaptive_dp(15),]

<AppLogo@RelativeLayout>:
    size_hint_y: None
    height: adaptive_dp(150) if not is_small_screen else adaptive_dp(120)
    Image:
        source: "flamingo_logo.png"
        size_hint: None, None
        size: adaptive_dp(130), adaptive_dp(130) if not is_small_screen else (adaptive_dp(100), adaptive_dp(100))
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<LoginFormLogo@RelativeLayout>:
    size_hint_y: None
    height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
    Image:
        source: "flamingo_logo.png"
        size_hint: None, None
        size: adaptive_dp(110), adaptive_dp(110) if not is_small_screen else (adaptive_dp(80), adaptive_dp(80))
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<StyledTextInput@TextInput>:
    multiline: False
    padding: [adaptive_dp(15), adaptive_dp(17)]
    background_color: 1, 1, 1, 0
    background_normal: ''
    background_active: ''
    foreground_color: 0.05, 0.05, 0.15, 1
    font_size: adaptive_font(18)
    size_hint_y: None
    height: adaptive_dp(55) if not is_small_screen else adaptive_dp(45)
    cursor_color: 0.05, 0.05, 0.15, 1
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [adaptive_dp(10),]
        Color:
            rgba: 0.8, 0.8, 0.8, 1
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, adaptive_dp(10)]
            width: 1

<PasswordTextInput>:
    size_hint_y: None
    height: adaptive_dp(55) if not is_small_screen else adaptive_dp(45)
    RelativeLayout:
        size_hint: 1, 1
        
        TextInput:
            id: password_input
            text: root.text
            hint_text: root.hint_text
            password: root.password
            multiline: False
            padding: [adaptive_dp(15), (self.height - self.line_height) / 2, adaptive_dp(55), (self.height - self.line_height) / 2]
            background_color: 1, 1, 1, 0
            background_normal: ''
            background_active: ''
            foreground_color: 0.05, 0.05, 0.15, 1
            font_size: adaptive_font(18)
            size_hint: 1, 1
            cursor_color: 0.05, 0.05, 0.15, 1
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [adaptive_dp(10),]
                Color:
                    rgba: 0.8, 0.8, 0.8, 1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, adaptive_dp(10)]
                    width: 1
        
        Button:
            size_hint: None, None
            size: adaptive_dp(45), adaptive_dp(45) if not is_small_screen else (adaptive_dp(35), adaptive_dp(35))
            pos_hint: {'right': 0.98, 'center_y': 0.5}
            background_color: 0, 0, 0, 0
            background_normal: ''
            on_press: root.toggle_password()

            Image:
                source: "icons/eye_open.png" if root.password else "icons/eye_closed.png"
                size_hint: None, None
                size: adaptive_dp(28), adaptive_dp(28) if not is_small_screen else (adaptive_dp(22), adaptive_dp(22))
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                center: self.parent.center_x, self.parent.center_y

<BottomMenuItem>:
    orientation: 'vertical'
    size_hint_x: 1
    spacing: adaptive_dp(5)
    padding: [adaptive_dp(5), adaptive_dp(5), adaptive_dp(5), adaptive_dp(10)]
    
    Image:
        source: root.icon_source
        size_hint: None, None
        size: adaptive_dp(35), adaptive_dp(35) if not is_small_screen else (adaptive_dp(28), adaptive_dp(28))
        pos_hint: {'center_x': 0.5}


<SavingsPlanItem>:
    is_selected: False
    plan_id: 0 
    plan_name: "" 
    current_amount: 0.0
    target_amount: 0.0
    progress: 0
    days_left: 0
    
    size_hint_y: None
    height: dp(90) 
    padding: dp(15)
    
    canvas.before:
        Color:
            rgba: SELECTED_ITEM_COLOR if root.is_selected else LIGHT_PINK
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(15),]
        Color:
            rgba: PRIMARY_PINK if root.is_selected else (0.7, 0.7, 0.7, 1)
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(15)]
            width: 2.5 if root.is_selected else 1
            
    BoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        
        Image:
            source: "icons/piggy_bank.png"
            size_hint: None, None
            size: dp(45), dp(45)
            pos_hint: {'center_y': 0.5}
        
        BoxLayout:
            orientation: 'vertical'
            padding: dp(2)
            spacing: dp(5)
            
            BoxLayout:
                size_hint_y: None
                height: dp(30)
                
                Label:
                    text: root.plan_name
                    font_size: dp(16)
                    color: PRIMARY_PINK
                    halign: 'left'
                    text_size: self.size
                    size_hint_x: 0.6
                    bold: True
                
                Label:
                    text: f"${root.current_amount:.2f} / ${root.target_amount:.2f}"
                    font_size: dp(14)
                    color: PRIMARY_BLUE
                    halign: 'right'
                    text_size: self.size
                    size_hint_x: 0.4
                    bold: True
                    
            BoxLayout:
                size_hint_y: None
                height: dp(20)
                spacing: dp(8)
                
                ProgressBar:
                    value: root.progress
                    max: 100
                    size_hint_x: 0.65
                    background_color: 0.9, 0.9, 0.9, 1
                    foreground_color: PRIMARY_BLUE
                    
                Label:
                    text: f"{root.progress:.0f}%"
                    font_size: dp(12)
                    color: PRIMARY_PINK
                    size_hint_x: 0.15
                    bold: True
                
                Label:
                    text: f"{root.days_left} –¥–Ω." if root.days_left > 0 else "‚àû"
                    font_size: dp(12)
                    color: PRIMARY_BLUE if root.days_left > 30 else ERROR_RED
                    size_hint_x: 0.2
                    bold: True

<StartScreen>:
    name: 'start_screen'
    canvas.before:
        Color:
            rgba: PRIMARY_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    GradientBox:
        color1: 0.9, 0.95, 1.0, 0
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(30)
        
        AppLogo:
            height: adaptive_dp(150) if not is_small_screen else adaptive_dp(120)

        Label:
            text: "Flamingo Cash"
            font_size: adaptive_font(48) if not is_small_screen else adaptive_font(36)
            bold: True
            color: 1, 1, 1, 1
            size_hint_y: None
            height: adaptive_dp(60) if not is_small_screen else adaptive_dp(45)

        Label:
            text: "Your modern financial assistant"
            font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
            color: 1, 1, 1, 0.8
            size_hint_y: None
            height: adaptive_dp(25)

        Widget:

        StyledButton:
            text: "Login"
            background_color: PRIMARY_PINK
            on_press:
                root.manager.transition.direction = 'left'
                root.manager.current = "login_screen"

        StyledButton:
            text: "Register"
            background_color: 1, 1, 1, 1
            color: PRIMARY_PINK
            on_press:
                root.manager.transition.direction = 'left'
                root.manager.current = "registration_screen"

<RegistrationScreen>:
    name: "registration_screen"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    GradientBox:
        color1: 1.0, 0.98, 0.98, 0
        orientation: "vertical"
        padding: adaptive_padding(30)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(100) if not is_small_screen else adaptive_dp(80)

        Label:
            text: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å"
            font_size: adaptive_font(30) if not is_small_screen else adaptive_font(24)
            bold: True
            color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(40)

        BoxLayout:
            orientation: "vertical"
            spacing: adaptive_dp(15)
            size_hint_y: None
            height: adaptive_dp(275) if not is_small_screen else adaptive_dp(220)

            StyledTextInput:
                id: username
                hint_text: "–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
            
            StyledTextInput:
                id: email
                hint_text: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞"
                    
            PasswordTextInput:
                id: password_field
                hint_text: "–ü–∞—Ä–æ–ª—å"

            PasswordTextInput:
                id: password_confirm_field
                hint_text: "–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å"

        StyledButton:
            text: "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è"
            background_color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
            on_press: root.register_user()

        Label:
            id: reg_message
            text: ""
            color: ERROR_RED
            size_hint_y: None
            height: adaptive_dp(30)

        BoxLayout:
            size_hint_y: None
            height: adaptive_dp(40)
            Label:
                text: "–í–∂–µ –º–∞—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å?"
                color: 0.2, 0.2, 0.2, 1
                font_size: adaptive_font(14)
            StyledButton:
                text: "–£–≤—ñ–π—Ç–∏"
                background_color: 0.8, 0.8, 0.8, 0
                color: PRIMARY_BLUE
                font_size: adaptive_font(16)
                bold: True
                size_hint_x: 0.5
                size_hint_y: None
                height: adaptive_dp(40)
                on_press: root.manager.current = 'login_screen'

<LoginScreen>:
    name: "login_screen"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    GradientBox:
        color1: 0.9, 0.95, 1.0, 0
        orientation: "vertical"
        padding: adaptive_padding(30)
        spacing: adaptive_dp(25)

        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)

        Label:
            text: "–í—Ö—ñ–¥ –¥–æ —Å–∏—Å—Ç–µ–º–∏"
            font_size: adaptive_font(34) if not is_small_screen else adaptive_font(28)
            bold: True
            color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(50)
        
        BoxLayout:
            orientation: "vertical"
            spacing: adaptive_dp(15)
            size_hint_y: None
            height: adaptive_dp(125) if not is_small_screen else adaptive_dp(100)

            StyledTextInput:
                id: email
                hint_text: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞"

            PasswordTextInput:
                id: password_field
                hint_text: "–ü–∞—Ä–æ–ª—å"

        StyledButton:
            text: "–£–≤—ñ–π—Ç–∏"
            background_color: PRIMARY_BLUE
            size_hint_y: None
            height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
            on_press: root.login_user()

        Label:
            id: login_message
            text: ""
            color: ERROR_RED
            size_hint_y: None
            height: adaptive_dp(30)

        Widget:
            size_hint_y: 1
        
        BoxLayout:
            size_hint_y: None
            height: adaptive_dp(40)
            Label:
                text: "–©–µ –Ω–µ –º–∞—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É?"
                color: 0.2, 0.2, 0.2, 1
                font_size: adaptive_font(14)
            StyledButton:
                text: "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è"
                background_color: 0.8, 0.8, 0.8, 0
                color: PRIMARY_PINK
                font_size: adaptive_font(16)
                bold: True
                size_hint_x: 0.5
                size_hint_y: None
                height: adaptive_dp(40)
                on_press: root.manager.current = 'registration_screen'

<HomeTab>:
    name: "home_tab"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: adaptive_padding(20)
        spacing: adaptive_dp(15)
        
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: adaptive_dp(300) if not is_small_screen else adaptive_dp(250)
            spacing: adaptive_dp(15)
            
            LoginFormLogo:
                height: adaptive_dp(80) if not is_small_screen else adaptive_dp(60)

            Label:
                id: welcome_label
                text: "Welcome!"
                font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
                bold: True
                color: PRIMARY_PINK
                size_hint_y: None
                height: adaptive_dp(40)

            Label:
                id: balance_label
                text: "Balance: $0"
                font_size: adaptive_font(24) if not is_small_screen else adaptive_font(20)
                color: PRIMARY_BLUE
                size_hint_y: None
                height: adaptive_dp(35)

            BoxLayout:
                spacing: adaptive_dp(15)
                size_hint_y: None
                height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
                StyledTextInput:
                    id: amount_input
                    hint_text: "Enter amount"
                    input_filter: "float"
                    height: adaptive_dp(55) if not is_small_screen else adaptive_dp(45)

                StyledButton:
                    text: "Add"
                    background_color: PRIMARY_PINK
                    size_hint_x: 0.4
                    on_press: root.add_money()

                StyledButton:
                    text: "Remove"
                    background_color: PRIMARY_BLUE
                    size_hint_x: 0.4
                    on_press: root.remove_money()

        Label:
            text: "Transaction History"
            font_size: adaptive_font(20) if not is_small_screen else adaptive_font(18)
            bold: True
            color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(35)

        ScrollView:
            size_hint_y: 1
            do_scroll_x: False
            bar_width: adaptive_dp(8)
            bar_color: PRIMARY_BLUE
            
            BoxLayout:
                id: history_container
                orientation: 'vertical'
                spacing: adaptive_dp(8)
                size_hint_y: None
                height: self.minimum_height
                padding: [adaptive_dp(5), adaptive_dp(5)]

<AnalyticsTab>:
    name: "analytics_tab"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
        
        Label:
            text: "Analytics"
            font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
            bold: True
            color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(40)
        
        Label:
            text: "Transaction history and charts will appear here"
            font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
            color: PRIMARY_BLUE
            halign: "center"
            text_size: self.width, None



<SavingsTab>:
    name: 'savings_tab'
    selected_plan_id: 0
    
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)
        
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # 1. –ë–õ–û–ö –°–¢–í–û–†–ï–ù–ù–Ø –ù–û–í–û–ì–û –ü–õ–ê–ù–£
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(200)
            spacing: dp(15)
            padding: dp(15)
            
            canvas.before:
                Color:
                    rgba: LIGHT_PINK
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(20),]
            
            Label:
                text: '–°—Ç–≤–æ—Ä–∏—Ç–∏ –ù–æ–≤–∏–π –ü–ª–∞–Ω –ó–∞–æ—â–∞–¥–∂–µ–Ω—å'
                font_size: dp(18)
                color: PRIMARY_PINK
                size_hint_y: None
                height: dp(30)
                bold: True

            GridLayout:
                cols: 3
                spacing: dp(10)
                size_hint_y: None
                height: dp(45)
                
                TextInput:
                    id: plan_name_input
                    hint_text: '–ù–∞–∑–≤–∞ –ø–ª–∞–Ω—É...'
                    multiline: False
                    size_hint_x: 0.35
                    height: dp(45)
                    background_color: 1, 1, 1, 1
                    foreground_color: 0.1, 0.1, 0.1, 1
                    padding: [dp(10), dp(13)]
                    
                TextInput:
                    id: target_amount_input
                    hint_text: '–¶—ñ–ª—å–æ–≤–∞ —Å—É–º–∞ ($)'
                    input_filter: 'float'
                    multiline: False
                    size_hint_x: 0.3
                    height: dp(45)
                    background_color: 1, 1, 1, 1
                    foreground_color: 0.1, 0.1, 0.1, 1
                    padding: [dp(10), dp(13)]
                
                BoxLayout:
                    size_hint_x: 0.35
                    spacing: dp(5)
                    TextInput:
                        id: deadline_input
                        hint_text: '–î–µ–¥–ª–∞–π–Ω'
                        multiline: False
                        size_hint_x: 0.7
                        height: dp(45)
                        background_color: 1, 1, 1, 1
                        foreground_color: 0.1, 0.1, 0.1, 1
                        padding: [dp(10), dp(13)]
                    Button:
                        size_hint_x: 0.3
                        background_color: PRIMARY_BLUE
                        on_press: root.show_calendar()
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10),]
                        Image:
                            source: "icons/calendar.png"
                            size_hint: None, None
                            size: dp(22), dp(22)
                            pos_hint: {'center_x': 0.5, 'center_y': 0.5}

            Button:
                size_hint_y: None
                height: dp(50)
                background_color: PRIMARY_PINK
                on_press: root.create_savings_plan()
                canvas.before:
                    Color:
                        rgba: self.background_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(15),]
                BoxLayout:
                    size: self.parent.size
                    pos: self.parent.pos
                    spacing: dp(10)
                    padding: [dp(15), 0]
                    Image:
                        source: "icons/rocket.png"
                        size_hint: None, None
                        size: dp(24), dp(24)
                        pos_hint: {'center_y': 0.5}
                    Label:
                        text: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –ü–ª–∞–Ω"
                        color: 1, 1, 1, 1
                        font_size: dp(16)
                        bold: True

        # –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç—É—Å
        Label:
            id: savings_message
            text: '–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–ª–∞–Ω'
            size_hint_y: None
            height: dp(30)
            color: PRIMARY_PINK
            text_size: self.size
            halign: 'center'
            valign: 'middle'
            font_size: dp(14)

        # 2. –ë–õ–û–ö –û–ü–ï–†–ê–¶–Ü–ô –ó –û–ë–†–ê–ù–ò–ú –ü–õ–ê–ù–û–ú
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(160)
            padding: dp(20)
            spacing: dp(15)
            
            canvas.before:
                Color:
                    rgba: LIGHT_BLUE
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(20),]
                    
            Label:
                id: selected_plan_label
                text: f'–û–±—Ä–∞–Ω–æ: {root.selected_plan_name}' if root.selected_plan_id > 0 else '–û–±–µ—Ä—ñ—Ç—å –ø–ª–∞–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π'
                color: PRIMARY_BLUE if root.selected_plan_id > 0 else (0.5, 0.5, 0.5, 1)
                font_size: dp(15)
                size_hint_y: None
                height: dp(25)
                bold: True if root.selected_plan_id > 0 else False
            
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: dp(10)
                
                TextInput:
                    id: savings_amount_input
                    hint_text: '–°—É–º–∞ ($)'
                    input_filter: 'float'
                    multiline: False
                    size_hint_x: 0.4
                    height: dp(50)
                    background_color: 1, 1, 1, 1
                    foreground_color: 0.1, 0.1, 0.1, 1
                    padding: [dp(10), dp(15)]
                
                Button:
                    id: add_funds_btn
                    background_color: PRIMARY_PINK
                    size_hint_x: 0.3
                    disabled: root.selected_plan_id == 0
                    on_press: root.add_to_savings_plan()
                    canvas.before:
                        Color:
                            rgba: self.background_color
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12),]
                    BoxLayout:
                        size: self.parent.size
                        pos: self.parent.pos
                        spacing: dp(5)
                        Image:
                            source: "icons/plus.png"
                            size_hint: None, None
                            size: dp(20), dp(20)
                            pos_hint: {'center_y': 0.5}
                        Label:
                            text: "–î–æ–¥–∞—Ç–∏"
                            color: 1, 1, 1, 1
                            font_size: dp(14)
                            bold: True
                
                Button:
                    id: withdraw_funds_btn
                    background_color: PRIMARY_BLUE
                    size_hint_x: 0.3
                    disabled: root.selected_plan_id == 0
                    on_press: root.remove_from_savings_plan()
                    canvas.before:
                        Color:
                            rgba: self.background_color
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12),]
                    BoxLayout:
                        size: self.parent.size
                        pos: self.parent.pos
                        spacing: dp(5)
                        Image:
                            source: "icons/minus.png"
                            size_hint: None, None
                            size: dp(20), dp(20)
                            pos_hint: {'center_y': 0.5}
                        Label:
                            text: "–í–∏–ª—É—á–∏—Ç–∏"
                            color: 1, 1, 1, 1
                            font_size: dp(14)
                            bold: True
            
            BoxLayout:
                size_hint_y: None
                height: dp(45)
                spacing: dp(10)
                
                Button:
                    id: edit_plan_btn
                    background_color: PRIMARY_BLUE
                    disabled: root.selected_plan_id == 0
                    on_press: root.edit_savings_plan()
                    canvas.before:
                        Color:
                            rgba: self.background_color
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12),]
                    BoxLayout:
                        size: self.parent.size
                        pos: self.parent.pos
                        spacing: dp(5)
                        Image:
                            source: "icons/edit.png"
                            size_hint: None, None
                            size: dp(20), dp(20)
                            pos_hint: {'center_y': 0.5}
                        Label:
                            text: "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏"
                            color: 1, 1, 1, 1
                            font_size: dp(14)
                            bold: True
                        
                Button:
                    id: delete_plan_btn
                    background_color: ERROR_RED
                    disabled: root.selected_plan_id == 0
                    on_press: root.delete_savings_plan()
                    canvas.before:
                        Color:
                            rgba: self.background_color
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12),]
                    BoxLayout:
                        size: self.parent.size
                        pos: self.parent.pos
                        spacing: dp(5)
                        Image:
                            source: "icons/delete.png"
                            size_hint: None, None
                            size: dp(20), dp(20)
                            pos_hint: {'center_y': 0.5}
                        Label:
                            text: "–í–∏–¥–∞–ª–∏—Ç–∏"
                            color: 1, 1, 1, 1
                            font_size: dp(14)
                            bold: True

        # 3. –ë–õ–û–ö –í–ê–®–ò–• –ê–ö–¢–ò–í–ù–ò–• –ü–õ–ê–ù–Ü–í
        Label:
            text: '–í–∞—à—ñ –¶—ñ–ª—ñ —Ç–∞ –ü—Ä–æ–≥—Ä–µ—Å'
            font_size: dp(18)
            color: PRIMARY_PINK
            size_hint_y: None
            height: dp(35)
            bold: True

        ScrollView:
            size_hint_y: 1
            bar_width: dp(8)
            bar_color: PRIMARY_BLUE
            bar_inactive_color: PRIMARY_BLUE
            
            GridLayout:
                id: savings_container
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(12)
                padding: dp(5)

        
<AITab>:
    name: "ai_tab"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
        
        Label:
            text: "ü§ñ AI Assistant"
            font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
            bold: True
            color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(40)
        
        Label:
            text: "Smart financial advice and predictions"
            font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
            color: PRIMARY_BLUE
            halign: "center"
            text_size: self.width, None

<AccountTab>:
    name: "account_tab"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
        
        Label:
            text: "üë§ Account Settings"
            font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
            bold: True
            color: PRIMARY_PINK
            size_hint_y: None
            height: adaptive_dp(40)
        
        Widget:
        
        BoxLayout:
            orientation: 'vertical'
            spacing: adaptive_dp(15)
            size_hint_y: None
            height: adaptive_dp(200) if not is_small_screen else adaptive_dp(160)
            
            Label:
                id: username_label
                text: "Username: "
                font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
                color: PRIMARY_PINK
                size_hint_y: None
                height: adaptive_dp(30)
            
            Label:
                id: email_label
                text: "Email: "
                font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
                color: PRIMARY_BLUE
                size_hint_y: None
                height: adaptive_dp(30)
            
            Widget:
            
            StyledButton:
                text: "Logout"
                background_color: PRIMARY_PINK
                height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
                on_press: root.logout()

# –ì–û–õ–û–í–ù–ò–ô –î–ê–®–ë–û–†–î
<DashboardScreen>:
    name: "dashboard_screen"
    canvas.before:
        Color:
            rgba: LIGHT_BLUE
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        
        ScreenManager:
            id: tab_manager
            canvas.before:
                Color:
                    rgba: LIGHT_BLUE
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            HomeTab:
            AnalyticsTab:
            SavingsTab:
            AITab:
            AccountTab:

        BoxLayout:
            size_hint_y: None
            height: adaptive_dp(70) if not is_small_screen else adaptive_dp(60)
            padding: adaptive_dp(10)
            spacing: adaptive_dp(10)
            canvas.before:
                Color:
                    rgba: PRIMARY_BLUE
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [adaptive_dp(25), adaptive_dp(25), 0, 0]

            BottomMenuItem:
                tab_name: "home"
                icon_source: "icons/home.png"

            BottomMenuItem:
                tab_name: "analytics"
                icon_source: "icons/analytics.png"

            BottomMenuItem:
                tab_name: "savings"
                icon_source: "icons/savings.png"

            BottomMenuItem:
                tab_name: "ai"
                icon_source: "icons/ai.png"

            BottomMenuItem:
                tab_name: "account"
                icon_source: "icons/account.png"