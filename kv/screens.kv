#:kivy 2.3.1
#:import dp kivy.metrics.dp
#:import Window kivy.core.window.Window
#:import Platform kivy.utils.platform

#:set is_mobile True if Platform in ['android', 'ios'] else False
#:set screen_width Window.width
#:set screen_height Window.height
#:set is_small_screen screen_width < 400
#:set is_tablet screen_width >= 600

#:set scale_factor 1.0 if is_tablet else (0.9 if is_small_screen else 1.0)
#:set text_scale 1.0 if is_tablet else (0.9 if is_small_screen else 1.0)
#:set padding_scale 1.0 if is_tablet else (0.8 if is_small_screen else 1.0)

#:set adaptive_dp lambda x: dp(x * scale_factor)
#:set adaptive_font lambda x: dp(x * text_scale)
#:set adaptive_padding lambda x: dp(x * padding_scale)


#: set DARK_BURGUNDY (0.5, 0.1, 0.2, 1) 
#: set LIGHT_PINK (1, 0.9, 0.95, 1)    
#: set TURQUOISE (0.14, 0.76, 0.88, 1) 
#: set SUCCESS_GREEN (0.2, 0.6, 0.2, 1)
#: set ERROR_RED (0.8, 0.2, 0.2, 1) 
#: set CREATION_BUTTON (0.8, 0.4, 0.45, 1) # –†–æ–∂–µ–≤–æ-—á–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ –°—Ç–≤–æ—Ä–∏—Ç–∏
#: set SELECTED_ITEM_COLOR (0.8, 0.95, 0.95, 1) # –î—É–∂–µ —Å–≤—ñ—Ç–ª–æ-–±—ñ—Ä—é–∑–æ–≤–∏–π –¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–Ω—è

<GradientBox@BoxLayout>:
    color1: 1, 1, 1, 1
    canvas.before:
        Color:
            rgba: self.color1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [adaptive_dp(30),]

<StyledButton@Button>:
    background_normal: ''
    background_color: 1, 1, 1, 1
    color: 1, 1, 1, 1
    font_size: adaptive_font(18)
    size_hint_y: None
    height: adaptive_dp(60)
    canvas.before:
        Color:
            rgba: self.background_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [adaptive_dp(15),]

<AppLogo@RelativeLayout>:
    size_hint_y: None
    height: adaptive_dp(150) if not is_small_screen else adaptive_dp(120)
    Image:
        source: "flamingo_logo.png"
        size_hint: None, None
        size: adaptive_dp(130), adaptive_dp(130) if not is_small_screen else (adaptive_dp(100), adaptive_dp(100))
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<LoginFormLogo@RelativeLayout>:
    size_hint_y: None
    height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
    Image:
        source: "flamingo_logo.png"
        size_hint: None, None
        size: adaptive_dp(110), adaptive_dp(110) if not is_small_screen else (adaptive_dp(80), adaptive_dp(80))
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<StyledTextInput@TextInput>:
    multiline: False
    padding: [adaptive_dp(15), adaptive_dp(17)]
    background_color: 1, 1, 1, 0
    background_normal: ''
    background_active: ''
    foreground_color: 0.05, 0.05, 0.15, 1
    font_size: adaptive_font(18)
    size_hint_y: None
    height: adaptive_dp(55) if not is_small_screen else adaptive_dp(45)
    cursor_color: 0.05, 0.05, 0.15, 1
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [adaptive_dp(10),]
        Color:
            rgba: 0.8, 0.8, 0.8, 1
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, adaptive_dp(10)]
            width: 1

<PasswordTextInput>:
    size_hint_y: None
    height: adaptive_dp(55) if not is_small_screen else adaptive_dp(45)
    RelativeLayout:
        size_hint: 1, 1
        
        TextInput:
            id: password_input
            text: root.text
            hint_text: root.hint_text
            password: root.password
            multiline: False
            padding: [adaptive_dp(15), (self.height - self.line_height) / 2, adaptive_dp(55), (self.height - self.line_height) / 2]
            background_color: 1, 1, 1, 0
            background_normal: ''
            background_active: ''
            foreground_color: 0.05, 0.05, 0.15, 1
            font_size: adaptive_font(18)
            size_hint: 1, 1
            cursor_color: 0.05, 0.05, 0.15, 1
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [adaptive_dp(10),]
                Color:
                    rgba: 0.8, 0.8, 0.8, 1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, adaptive_dp(10)]
                    width: 1
        
        Button:
            size_hint: None, None
            size: adaptive_dp(45), adaptive_dp(45) if not is_small_screen else (adaptive_dp(35), adaptive_dp(35))
            pos_hint: {'right': 0.98, 'center_y': 0.5}
            background_color: 0, 0, 0, 0
            background_normal: ''
            on_press: root.toggle_password()

            Image:
                source: "icons/eye_open.png" if root.password else "icons/eye_closed.png"
                size_hint: None, None
                size: adaptive_dp(28), adaptive_dp(28) if not is_small_screen else (adaptive_dp(22), adaptive_dp(22))
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                center: self.parent.center_x, self.parent.center_y

<BottomMenuItem>:
    orientation: 'vertical'
    size_hint_x: 1
    spacing: adaptive_dp(5)
    padding: [adaptive_dp(5), adaptive_dp(5), adaptive_dp(5), adaptive_dp(10)]
    
    Image:
        source: root.icon_source
        size_hint: None, None
        size: adaptive_dp(35), adaptive_dp(35) if not is_small_screen else (adaptive_dp(28), adaptive_dp(28))
        pos_hint: {'center_x': 0.5}

<SavingsPlanItem>:
    is_selected: False # –ü—Ä–∏–≤'—è–∑–∫–∞ –¥–æ BooleanProperty —É Python
    
    # –í–∏—Å–æ—Ç–∞ –µ–ª–µ–º–µ–Ω—Ç–∞
    size_hint_y: None
    height: dp(80) 
    padding: dp(10)
    
    # –°—Ç–∏–ª—å –±–ª–æ–∫—É (—Ç—ñ–Ω—å/–∑–∞–æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è)
    canvas.before:
        Color:
            # === –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ is_selected, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏ 173 ===
            rgba: SELECTED_ITEM_COLOR if root.is_selected else (0.98, 0.98, 0.98, 1)
        Rectangle:
            pos: self.pos
            size: self.size
        # –ù–µ–≤–µ–ª–∏–∫–∞ —Ä–∞–º–∫–∞
        Color:
            rgba: DARK_BURGUNDY[0], DARK_BURGUNDY[1], DARK_BURGUNDY[2], 0.3
        Line:
            width: 1.5
            rectangle: self.x, self.y, self.width, self.height
            
    # –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –¥–ª—è –≤–∏–±–æ—Ä—É –ø–ª–∞–Ω—É
    on_touch_down:
        if self.collide_point(*args[1].pos): root.on_plan_select(root.plan_id, root.plan_name)
    
    BoxLayout:
        orientation: 'vertical'
        padding: dp(5)
        spacing: dp(3)
        
        # –í–µ—Ä—Ö–Ω—ñ–π —Ä—è–¥–æ–∫: –ù–∞–∑–≤–∞ —Ç–∞ –°—É–º–∏
        BoxLayout:
            size_hint_y: None
            height: dp(25)
            
            Label:
                text: root.plan_name
                font_size: dp(16)
                color: DARK_BURGUNDY
                halign: 'left'
                text_size: self.size
                size_hint_x: 0.6
                bold: True
            
            Label:
                text: f"${root.current_amount:.2f} / ${root.target_amount:.2f}"
                font_size: dp(14)
                color: DARK_BURGUNDY
                halign: 'right'
                text_size: self.size
                size_hint_x: 0.4
                
        # –°–µ—Ä–µ–¥–Ω—ñ–π —Ä—è–¥–æ–∫: –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä —Ç–∞ –í—ñ–¥—Å–æ—Ç–∫–∏
        BoxLayout:
            size_hint_y: None
            height: dp(15)
            spacing: dp(5)
            
            ProgressBar:
                value: root.progress
                max: 100
                size_hint_x: 0.7
                background_color: 0.9, 0.9, 0.9, 1
                foreground_color: TURQUOISE
                
            Label:
                text: f"{root.progress:.0f}%"
                font_size: dp(12)
                color: DARK_BURGUNDY
                size_hint_x: 0.15
            
            Label:
                text: f"{root.days_left} –¥–Ω." if root.days_left > 0 else "‚àû"
                font_size: dp(12)
                color: TURQUOISE if root.days_left > 30 else ERROR_RED
                size_hint_x: 0.15

<StartScreen>:
    name: 'start_screen'
    canvas.before:
        Color:
            rgba: 0.14, 0.76, 0.88, 1
        Rectangle:
            pos: self.pos
            size: self.size
    GradientBox:
        color1: 0.9, 0.95, 1.0, 0
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(30)
        
        AppLogo:
            height: adaptive_dp(150) if not is_small_screen else adaptive_dp(120)

        Label:
            text: "Flamingo Cash"
            font_size: adaptive_font(48) if not is_small_screen else adaptive_font(36)
            bold: True
            color: 1, 1, 1, 1
            size_hint_y: None
            height: adaptive_dp(60) if not is_small_screen else adaptive_dp(45)

        Label:
            text: "Your modern financial assistant"
            font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
            color: 1, 1, 1, 0.8
            size_hint_y: None
            height: adaptive_dp(25)

        Widget:

        StyledButton:
            text: "Login"
            background_color: 1.0, 0.42, 0.42, 1
            on_press:
                root.manager.transition.direction = 'left'
                root.manager.current = "login_screen"

        StyledButton:
            text: "Register"
            background_color: 1, 1, 1, 1
            color: 1.0, 0.42, 0.42, 1
            on_press:
                root.manager.transition.direction = 'left'
                root.manager.current = "registration_screen"

<RegistrationScreen>:
    name: "registration_screen"
    canvas.before:
        Color:
            rgba: 0.9, 0.95, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    GradientBox:
        color1: 1.0, 0.98, 0.98, 0
        orientation: "vertical"
        padding: adaptive_padding(30)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(100) if not is_small_screen else adaptive_dp(80)

        Label:
            text: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å"
            font_size: adaptive_font(30) if not is_small_screen else adaptive_font(24)
            bold: True
            color: 0.05, 0.05, 0.15, 1
            size_hint_y: None
            height: adaptive_dp(40)

        BoxLayout:
            orientation: "vertical"
            spacing: adaptive_dp(15)
            size_hint_y: None
            height: adaptive_dp(275) if not is_small_screen else adaptive_dp(220)

            StyledTextInput:
                id: username
                hint_text: "–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
            
            StyledTextInput:
                id: email
                hint_text: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞"
                    
            PasswordTextInput:
                id: password_field
                hint_text: "–ü–∞—Ä–æ–ª—å"

            PasswordTextInput:
                id: password_confirm_field
                hint_text: "–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å"

        StyledButton:
            text: "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è"
            background_color: 1.0, 0.42, 0.42, 1
            size_hint_y: None
            height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
            on_press: root.register_user()

        Label:
            id: reg_message
            text: ""
            color: 0.8, 0, 0, 1
            size_hint_y: None
            height: adaptive_dp(30)

        BoxLayout:
            size_hint_y: None
            height: adaptive_dp(40)
            Label:
                text: "–í–∂–µ –º–∞—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å?"
                color: 0.2, 0.2, 0.2, 1
                font_size: adaptive_font(14)
            StyledButton:
                text: "–£–≤—ñ–π—Ç–∏"
                background_color: 0.8, 0.8, 0.8, 0
                color: 0.14, 0.76, 0.88, 1
                font_size: adaptive_font(16)
                bold: True
                size_hint_x: 0.5
                size_hint_y: None
                height: adaptive_dp(40)
                on_press: root.manager.current = 'login_screen'

<LoginScreen>:
    name: "login_screen"
    canvas.before:
        Color:
            rgba: 0.9, 0.95, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    GradientBox:
        color1: 0.9, 0.95, 1.0, 0
        orientation: "vertical"
        padding: adaptive_padding(30)
        spacing: adaptive_dp(25)

        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)

        Label:
            text: "–í—Ö—ñ–¥ –¥–æ —Å–∏—Å—Ç–µ–º–∏"
            font_size: adaptive_font(34) if not is_small_screen else adaptive_font(28)
            bold: True
            color: 0.05, 0.05, 0.15, 1
            size_hint_y: None
            height: adaptive_dp(50)
        
        BoxLayout:
            orientation: "vertical"
            spacing: adaptive_dp(15)
            size_hint_y: None
            height: adaptive_dp(125) if not is_small_screen else adaptive_dp(100)

            StyledTextInput:
                id: email
                hint_text: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞"

            PasswordTextInput:
                id: password_field
                hint_text: "–ü–∞—Ä–æ–ª—å"

        StyledButton:
            text: "–£–≤—ñ–π—Ç–∏"
            background_color: 0.14, 0.76, 0.88, 1
            size_hint_y: None
            height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
            on_press: root.login_user()

        Label:
            id: login_message
            text: ""
            color: 0.8, 0, 0, 1
            size_hint_y: None
            height: adaptive_dp(30)

        Widget:
            size_hint_y: 1
        
        BoxLayout:
            size_hint_y: None
            height: adaptive_dp(40)
            Label:
                text: "–©–µ –Ω–µ –º–∞—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É?"
                color: 0.2, 0.2, 0.2, 1
                font_size: adaptive_font(14)
            StyledButton:
                text: "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è"
                background_color: 0.8, 0.8, 0.8, 0
                color: 1.0, 0.42, 0.42, 1
                font_size: adaptive_font(16)
                bold: True
                size_hint_x: 0.5
                size_hint_y: None
                height: adaptive_dp(40)
                on_press: root.manager.current = 'registration_screen'

<HomeTab>:
    name: "home_tab"
    canvas.before:
        Color:
            rgba: 0.95, 0.98, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        padding: adaptive_padding(20)
        spacing: adaptive_dp(15)
        
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: adaptive_dp(300) if not is_small_screen else adaptive_dp(250)
            spacing: adaptive_dp(15)
            
            LoginFormLogo:
                height: adaptive_dp(80) if not is_small_screen else adaptive_dp(60)

            Label:
                id: welcome_label
                text: "Welcome!"
                font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
                bold: True
                color: 0.05, 0.05, 0.15, 1
                size_hint_y: None
                height: adaptive_dp(40)

            Label:
                id: balance_label
                text: "Balance: $0"
                font_size: adaptive_font(24) if not is_small_screen else adaptive_font(20)
                color: 0.05, 0.05, 0.15, 1
                size_hint_y: None
                height: adaptive_dp(35)

            BoxLayout:
                spacing: adaptive_dp(15)
                size_hint_y: None
                height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
                StyledTextInput:
                    id: amount_input
                    hint_text: "Enter amount"
                    input_filter: "float"
                    height: adaptive_dp(55) if not is_small_screen else adaptive_dp(45)

                StyledButton:
                    text: "Add"
                    background_color: 1.0, 0.42, 0.42, 1
                    size_hint_x: 0.4
                    on_press: root.add_money()

                StyledButton:
                    text: "Remove"
                    background_color: 0.14, 0.76, 0.88, 1
                    size_hint_x: 0.4
                    on_press: root.remove_money()

        Label:
            text: "Transaction History"
            font_size: adaptive_font(20) if not is_small_screen else adaptive_font(18)
            bold: True
            color: 0.05, 0.05, 0.15, 1
            size_hint_y: None
            height: adaptive_dp(35)

        ScrollView:
            size_hint_y: 1
            do_scroll_x: False
            bar_width: adaptive_dp(8)
            bar_color: 0.14, 0.76, 0.88, 0.7
            
            BoxLayout:
                id: history_container
                orientation: 'vertical'
                spacing: adaptive_dp(8)
                size_hint_y: None
                height: self.minimum_height
                padding: [adaptive_dp(5), adaptive_dp(5)]

<AnalyticsTab>:
    name: "analytics_tab"
    canvas.before:
        Color:
            rgba: 0.95, 0.98, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
        
        Label:
            text: "üìä Analytics"
            font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
            bold: True
            color: 0.05, 0.05, 0.15, 1
            size_hint_y: None
            height: adaptive_dp(40)
        
        Label:
            text: "Transaction history and charts will appear here"
            font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
            color: 0.05, 0.05, 0.15, 0.8
            halign: "center"
            text_size: self.width, None

<SavingsTab>:
    name: 'savings_tab'
    selected_plan_id: 0 # –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ü—è –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å —î —É –≤–∞—à–æ–º—É Python –∫–ª–∞—Å—ñ SavingsTab!
    
    BoxLayout:
        orientation: 'vertical'
        padding: dp(15)
        spacing: dp(15)
        
        # –ó–∞–≥–∞–ª—å–Ω–∏–π —Ñ–æ–Ω (–±—ñ–ª–∏–π)
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # 1. –ë–õ–û–ö –°–¢–í–û–†–ï–ù–ù–Ø –ù–û–í–û–ì–û –ü–õ–ê–ù–£
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(180)
            spacing: dp(10)
            
            Label:
                text: '‚ú® –°—Ç–≤–æ—Ä–∏—Ç–∏ –ù–æ–≤–∏–π –ü–ª–∞–Ω –ó–∞–æ—â–∞–¥–∂–µ–Ω—å'
                font_size: dp(18)
                color: DARK_BURGUNDY
                size_hint_y: None
                height: dp(30)

            # –ü–æ–ª—è –≤–≤–æ–¥—É
            GridLayout:
                cols: 3
                spacing: dp(10)
                size_hint_y: None
                height: dp(40)
                
                TextInput:
                    id: plan_name_input
                    hint_text: '–ù–∞–∑–≤–∞ –ø–ª–∞–Ω—É...'
                    multiline: False
                    size_hint_x: 0.35
                    height: dp(40)
                    
                TextInput:
                    id: target_amount_input
                    hint_text: '–¶—ñ–ª—å–æ–≤–∞ —Å—É–º–∞ ($)'
                    input_type: 'number'
                    multiline: False
                    size_hint_x: 0.3
                    height: dp(40)
                
                BoxLayout:
                    size_hint_x: 0.35
                    spacing: dp(5)
                    TextInput:
                        id: deadline_input
                        hint_text: '–î–µ–¥–ª–∞–π–Ω'
                        multiline: False
                        size_hint_x: 0.7
                        height: dp(40)
                    Button:
                        text: 'üìÖ'
                        size_hint_x: 0.3
                        background_color: TURQUOISE
                        on_press: root.show_calendar()

            # –ö–Ω–æ–ø–∫–∞ –°—Ç–≤–æ—Ä–∏—Ç–∏
            Button:
                text: 'üöÄ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ü–ª–∞–Ω'
                size_hint_y: None
                height: dp(45)
                background_color: CREATION_BUTTON
                on_press: root.create_savings_plan()

        # –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç—É—Å
        Label:
            id: savings_message
            text: 'üéØ –í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–ª–∞–Ω'
            size_hint_y: None
            height: dp(25)
            color: DARK_BURGUNDY
            text_size: self.size
            halign: 'center'
            valign: 'middle'
        
        # –í—ñ–∑—É–∞–ª—å–Ω–∏–π —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫
        Widget:
            size_hint_y: None
            height: dp(1)
            canvas:
                Color:
                    rgba: DARK_BURGUNDY[0], DARK_BURGUNDY[1], DARK_BURGUNDY[2], 0.3
                Rectangle:
                    pos: self.pos
                    size: self.size

        # 2. –ë–õ–û–ö –û–ü–ï–†–ê–¶–Ü–ô –ó –û–ë–†–ê–ù–ò–ú –ü–õ–ê–ù–û–ú
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(130)
            padding: dp(10)
            spacing: dp(10)
            
            # –§–æ–Ω –±–ª–æ–∫—É –æ–ø–µ—Ä–∞—Ü—ñ–π (—Å–≤—ñ—Ç–ª–æ-—Ä–æ–∂–µ–≤–∏–π)
            canvas.before:
                Color:
                    rgba: LIGHT_PINK[0], LIGHT_PINK[1], LIGHT_PINK[2], 0.7 
                Rectangle:
                    pos: self.pos
                    size: self.size
                    
            Label:
                id: selected_plan_label
                text: f'‚úÖ –û–±—Ä–∞–Ω–æ: {root.selected_plan_name}' if root.selected_plan_id > 0 else 'üëÜ –û–±–µ—Ä—ñ—Ç—å –ø–ª–∞–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π'
                color: DARK_BURGUNDY if root.selected_plan_id > 0 else (0.5, 0.5, 0.5, 1)
                font_size: dp(14)
                size_hint_y: None
                height: dp(20)
            
            # –ü–æ–ª–µ –≤–≤–æ–¥—É —Å—É–º–∏ —Ç–∞ –æ—Å–Ω–æ–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(10)
                
                TextInput:
                    id: savings_amount_input
                    hint_text: '–°—É–º–∞ ($)'
                    input_type: 'number'
                    multiline: False
                    size_hint_x: 0.4
                    height: dp(40)
                
                Button:
                    id: add_funds_btn
                    text: '+ –î–æ–¥–∞—Ç–∏'
                    background_color: CREATION_BUTTON[0], CREATION_BUTTON[1]*0.8, CREATION_BUTTON[2]*0.8, 1
                    size_hint_x: 0.3
                    disabled: root.selected_plan_id == 0
                    on_press: root.add_to_savings_plan()
                
                Button:
                    id: withdraw_funds_btn
                    text: '- –í–∏–ª—É—á–∏—Ç–∏'
                    background_color: (0.6, 0.6, 0.6, 1)
                    size_hint_x: 0.3
                    disabled: root.selected_plan_id == 0
                    on_press: root.remove_from_savings_plan()
            
            # –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(10)
                
                Button:
                    id: edit_plan_btn
                    text: '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏'
                    background_color: TURQUOISE
                    disabled: root.selected_plan_id == 0
                    on_press: root.edit_savings_plan()
                    
                Button:
                    id: delete_plan_btn
                    text: 'üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏'
                    background_color: ERROR_RED
                    disabled: root.selected_plan_id == 0
                    on_press: root.delete_savings_plan()

        # 3. –ë–õ–û–ö –í–ê–®–ò–• –ê–ö–¢–ò–í–ù–ò–• –ü–õ–ê–ù–Ü–í (–°–ü–ò–°–û–ö)
        Label:
            text: 'üí∞ –í–∞—à—ñ –¶—ñ–ª—ñ —Ç–∞ –ü—Ä–æ–≥—Ä–µ—Å'
            font_size: dp(18)
            color: DARK_BURGUNDY
            size_hint_y: None
            height: dp(30)

        ScrollView:
            size_hint_y: 1
            
            GridLayout:
                id: savings_container
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)
                padding: dp(5)

<AITab>:
    name: "ai_tab"
    canvas.before:
        Color:
            rgba: 0.95, 0.98, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
        
        Label:
            text: "ü§ñ AI Assistant"
            font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
            bold: True
            color: 0.05, 0.05, 0.15, 1
            size_hint_y: None
            height: adaptive_dp(40)
        
        Label:
            text: "Smart financial advice and predictions"
            font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
            color: 0.05, 0.05, 0.15, 0.8
            halign: "center"
            text_size: self.width, None

<AccountTab>:
    name: "account_tab"
    canvas.before:
        Color:
            rgba: 0.95, 0.98, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: adaptive_padding(40)
        spacing: adaptive_dp(20)
        
        LoginFormLogo:
            height: adaptive_dp(120) if not is_small_screen else adaptive_dp(90)
        
        Label:
            text: "üë§ Account Settings"
            font_size: adaptive_font(28) if not is_small_screen else adaptive_font(24)
            bold: True
            color: 0.05, 0.05, 0.15, 1
            size_hint_y: None
            height: adaptive_dp(40)
        
        Widget:
        
        BoxLayout:
            orientation: 'vertical'
            spacing: adaptive_dp(15)
            size_hint_y: None
            height: adaptive_dp(200) if not is_small_screen else adaptive_dp(160)
            
            Label:
                id: username_label
                text: "Username: "
                font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
                color: 0.05, 0.05, 0.15, 1
                size_hint_y: None
                height: adaptive_dp(30)
            
            Label:
                id: email_label
                text: "Email: "
                font_size: adaptive_font(18) if not is_small_screen else adaptive_font(16)
                color: 0.05, 0.05, 0.15, 1
                size_hint_y: None
                height: adaptive_dp(30)
            
            Widget:
            
            StyledButton:
                text: "Logout"
                background_color: 1.0, 0.42, 0.42, 1
                height: adaptive_dp(60) if not is_small_screen else adaptive_dp(50)
                on_press: root.logout()

# –ì–û–õ–û–í–ù–ò–ô –î–ê–®–ë–û–†–î
<DashboardScreen>:
    name: "dashboard_screen"
    canvas.before:
        Color:
            rgba: 0.95, 0.98, 1.0, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: "vertical"
        
        ScreenManager:
            id: tab_manager
            canvas.before:
                Color:
                    rgba: 0.95, 0.98, 1.0, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            HomeTab:
            AnalyticsTab:
            SavingsTab:
            AITab:
            AccountTab:

        BoxLayout:
            size_hint_y: None
            height: adaptive_dp(70) if not is_small_screen else adaptive_dp(60)
            padding: adaptive_dp(10)
            spacing: adaptive_dp(10)
            canvas.before:
                Color:
                    rgba: 0.14, 0.76, 0.88, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [adaptive_dp(25), adaptive_dp(25), 0, 0]
# –£ –∫—ñ–Ω—Ü—ñ DashboardScreen –≤ KV —Ñ–∞–π–ª—ñ
            BottomMenuItem:
                tab_name: "home"
                icon_source: "icons/home.png"

            BottomMenuItem:
                tab_name: "analytics"
                icon_source: "icons/analytics.png"

            BottomMenuItem:
                tab_name: "savings"
                icon_source: "icons/savings.png"

            BottomMenuItem:
                tab_name: "ai"
                icon_source: "icons/ai.png"

            BottomMenuItem:
                tab_name: "account"
                icon_source: "icons/account.png"